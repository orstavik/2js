---
#
---
<link rel="preload" href="https://orstavik.github.io/JoiComponents/autoDocs/book.json">
<script defer src="https://unpkg.com/joicomponents@1.2.29/book/chapter6_layout/demo/SideBar.js"></script>
<script defer type="module" src="https://unpkg.com/joicomponents@1.3.1/book/chapter11_iframe/demo/InlineIframe.js"></script>
<script defer type="module" src="https://unpkg.com/joicomponents@1.3.2/book/chapter7_html_comp/demo/TreeNode.js"></script>
<script defer type="module" src="https://unpkg.com/joicomponents@1.3.3/book/chapter6_layout/demo/GoldenPage.js"></script>
<script src="assets/wc/BarMenu.js"></script>
<script defer src="assets/events/touch-hover.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/joievents@1.0.14/src/webcomps/PrettyPrinter.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/joievents@1.0.14/src/webcomps/CodeDemo.js">
  //todo move PrettyPrinter.js and CodeDemo.js into this chapter.
  //todo move TreeNode to its own RecursiveElement chapter.
  //todo Move the code away from this repo to the JoiComponents repo.
  //todo move touchover to ComposedEvent.
  //todo make the Menu into a web comp. The problem is that it listens for the attribute, so that it needs to set its
  //todo style as a custom css property instead of a variable in the lightDOM, unless we make it into a element that
  //todo replaces itself with a series of treenodes.. A web comp that populates the lightDOM.
  //todo fix a chapter for PowerIframe
  //todo fix a chapter for properties and attributes competing
  //todo bug in menu, the menu should be added after the content, so that it has visual priority, or use z-index,
  //todo but as that is global it is unsafe.
</script>

<link href="docs/menu.css" rel="stylesheet"/>
<link rel="stylesheet" id="uno" href="{{ 'assets/css/style.css' | relative_url }}"/>
<style>
  * {
    margin: 0;
    padding: 0;
  }
  golden-page {
    display: block;
    background: white;
  }
  #bar-menu {
    background-color: lightblue;
    display: block;
    width: 100%;
    height: 100%;
  }
</style>
<side-bar>
  <div id="bar-menu" slot="menu"></div>
  <golden-page>
    <inline-iframe
        included-resources="link#uno"
        flow-width="400" sandbox="allow-scripts" srcdoc="<i>Hello sunshine â‚¬</i>"></inline-iframe>
  </golden-page>
</side-bar>

<script>
  let menu = {};

  async function loadMenu(){
    const jsonCon = await fetch("https://orstavik.github.io/JoiComponents/autoDocs/book.json");
    const mdFiles = await jsonCon.json();
    for (let [path, content] of mdFiles)
      menu[path] = content;
    const barMenu = document.querySelector("#bar-menu");

    const [bookNodes, count] = makeMenu(mdFiles, "JoiComponents");
    barMenu.appendChild(bookNodes);
    document.styleSheets[0].cssRules[5].style.paddingLeft = (100 / count) + "%";
    const nodeList = barMenu.querySelectorAll("a");
    for (let i = 0; i < nodeList.length; i++)
      nodeList[i].setAttribute("touch-hover", "click");
  }
  loadMenu();

  window.addEventListener("resize", function(){
    const iiframe = document.querySelector("inline-iframe");
    iiframe.setAttribute("flow-width", iiframe.offsetWidth);
  });

  document.querySelector("#bar-menu").addEventListener("touch-hover", function onTouchHover(e) {
    e.detail.enter === true ? e.target.setAttribute("hover", "") : e.target.removeAttribute("hover");
  });

  window.addEventListener("hashchange", function () {
    const path = window.location.hash.substr(1);
    const base = "https://orstavik.github.io/JoiComponents" + path;
    const content = menu[path];
    let iframe = document.querySelector("inline-iframe");
    iframe.setAttribute("base", base);
    iframe.setContent(content);
  });
</script>
